# =============================================================================
# MANDREL UNIFIED ENVIRONMENT CONFIGURATION
# =============================================================================
# Copy this file to .env: cp .env.example .env
# This file documents ALL environment variables for all Mandrel components.
#
# Components:
#   - MCP Server (mcp-server/)
#   - Mandrel Command Backend (mandrel-command/backend/)
#   - Mandrel Command Frontend (mandrel-command/frontend/)
#
# Legend:
#   [REQUIRED] - Must be set for the application to function
#   [OPTIONAL] - Has a sensible default, can be overridden
#   [DEV-ONLY] - Only used in development environments
#   [PROD-ONLY] - Only used in production environments
#
# =============================================================================


# =============================================================================
# ENVIRONMENT
# =============================================================================
# [REQUIRED] Application environment - affects logging, security, and defaults

NODE_ENV=development
# Options: development, staging, production


# =============================================================================
# DATABASE (PostgreSQL with pgvector)
# =============================================================================
# [REQUIRED] Database connection settings
# Used by: MCP Server, Mandrel Command Backend
#
# Prerequisites:
#   - PostgreSQL 14+ with pgvector extension
#   - Extensions: vector, pg_trgm, pgcrypto, uuid-ossp
#
# Docker: These defaults work with docker-compose out of the box
# Native: Update user/password for your local PostgreSQL installation

DATABASE_HOST=localhost
# Database server hostname or IP address

DATABASE_PORT=5432
# PostgreSQL port (default: 5432)

DATABASE_NAME=mandrel
# Database name (canonical name used across all environments)

DATABASE_USER=mandrel
# Database username

DATABASE_PASSWORD=mandrel_dev_password
# [REQUIRED] Database password
# IMPORTANT: Change this in production!

# [OPTIONAL] Full connection URL (alternative to individual settings above)
# DATABASE_URL=postgresql://mandrel:password@localhost:5432/mandrel
# Note: If set, this takes precedence over individual DATABASE_* variables


# =============================================================================
# REDIS (BullMQ Job Queues)
# =============================================================================
# [OPTIONAL] Redis connection for background job processing
# Used by: MCP Server (job queues)

REDIS_URL=redis://localhost:6379
# Full Redis connection URL


# =============================================================================
# MCP SERVER CONFIGURATION
# =============================================================================
# Settings specific to the MCP (Model Context Protocol) server

MANDREL_MCP_PORT=8080
# [OPTIONAL] Port for MCP server (default: 8080)

# MANDREL_MCP_BRIDGE_PORT=8081
# [OPTIONAL] Port for MCP HTTP bridge (production only)

MCP_DEBUG=errors
# [OPTIONAL] MCP debug level
# Options: none, errors, all


# =============================================================================
# MANDREL COMMAND SERVER CONFIGURATION
# =============================================================================
# Settings specific to the Mandrel Command dashboard backend

MANDREL_HTTP_PORT=5000
# [OPTIONAL] Port for Mandrel Command HTTP server (default: 5000)

# MANDREL_COMMAND_PROD_PORT=5000
# [PROD-ONLY] Production port for Mandrel Command

CORS_ORIGIN=http://localhost:3000,http://localhost:3001
# [OPTIONAL] Comma-separated list of allowed CORS origins
# IMPORTANT: In production, restrict to your actual domain(s)
# Example: CORS_ORIGIN=https://command.yourdomain.com

FRONTEND_URL=http://localhost:3000
# [DEV-ONLY] Frontend URL for development CORS configuration


# =============================================================================
# AUTHENTICATION (JWT)
# =============================================================================
# [REQUIRED for Mandrel Command] JSON Web Token configuration
# Used by: Mandrel Command Backend

JWT_SECRET=mandrel-dev-secret-change-in-production-minimum-32-chars
# [REQUIRED] Secret key for signing JWTs
# CRITICAL: Change this in production! Minimum 32 characters recommended.

JWT_EXPIRES_IN=24h
# [OPTIONAL] Token expiration time (default: 24h)
# Formats: 60, "2 days", "10h", "7d"

BCRYPT_ROUNDS=12
# [OPTIONAL] bcrypt hashing rounds (default: 12)
# Higher = more secure but slower. Range: 10-14 recommended


# =============================================================================
# LOGGING
# =============================================================================
# [OPTIONAL] Logging configuration for all components

LOG_LEVEL=info
# Application log level
# Options: error, warn, info, debug, trace
# Recommended: info (development), warn (production)

DB_LOG_LEVEL=warn
# Database query log level
# Options: error, warn, info, debug
# Recommended: warn (development), error (production)

ENABLE_LOG_ROTATION=true
# [OPTIONAL] Enable log file rotation (default: true)

LOG_MAX_FILE_SIZE=20m
# [OPTIONAL] Maximum log file size before rotation
# Options: 10m, 20m, 50m, 100m

LOG_MAX_FILES=30d
# [OPTIONAL] How long to keep rotated log files
# Options: 7d, 14d, 30d, 60d


# =============================================================================
# FEATURE FLAGS
# =============================================================================
# [OPTIONAL] Toggle features on/off without code changes
# Used by: Mandrel Command Backend

FEATURE_FLAG_PHASE1_FEATURE_FLAGS=false
# Enable Phase 1 feature flags system

FEATURE_FLAG_PHASE1_CONTRACT_TESTS=false
# Enable Phase 1 contract testing

FEATURE_FLAG_PHASE1_REACT_ERROR_BOUNDARIES=false
# Enable React error boundaries (recommended: true in production)


# =============================================================================
# RATE LIMITING (Production)
# =============================================================================
# [PROD-ONLY] Protect against abuse

# RATE_LIMIT_WINDOW_MS=300000
# Rate limit window in milliseconds (default: 5 minutes)

# RATE_LIMIT_MAX_REQUESTS=50
# Maximum requests per window per IP

# MAX_FILE_SIZE=5242880
# Maximum upload file size in bytes (default: 5MB)

# UPLOAD_DIR=/var/mandrel/uploads
# Directory for uploaded files (production)


# =============================================================================
# EMBEDDING & AI CONFIGURATION (Future)
# =============================================================================
# [OPTIONAL] Vector embedding configuration (reserved for future use)

# EMBEDDING_MODEL=text-embedding-ada-002
# Embedding model to use (currently using local Transformers.js)

# EMBEDDING_DIMENSIONS=1536
# Vector dimensions (must match model output)

# OPENAI_API_KEY=your_openai_api_key_here
# OpenAI API key (if using OpenAI embeddings)


# =============================================================================
# EXTERNAL SERVICES (Optional)
# =============================================================================
# [OPTIONAL] Third-party service integrations

# SENTRY_DSN=https://your-sentry-dsn
# Sentry error tracking DSN

# DATADOG_API_KEY=your-datadog-key
# Datadog monitoring API key

# VAULT_URL=https://vault.example.com
# HashiCorp Vault URL for secrets management

# AWS_SSM_PARAMETER_PREFIX=/mandrel/
# AWS SSM Parameter Store prefix


# =============================================================================
# NOTES
# =============================================================================
#
# Database Setup (Native, without Docker):
#   1. Install PostgreSQL 14+ with pgvector extension
#   2. Create database: createdb mandrel
#   3. Enable extensions:
#      psql -d mandrel -c "CREATE EXTENSION vector;"
#      psql -d mandrel -c "CREATE EXTENSION pg_trgm;"
#      psql -d mandrel -c "CREATE EXTENSION pgcrypto;"
#      psql -d mandrel -c "CREATE EXTENSION \"uuid-ossp\";"
#   4. Update DATABASE_USER and DATABASE_PASSWORD above
#
# Docker Setup:
#   - Default values work with docker-compose out of the box
#   - Just copy this file to .env and run: docker-compose up
#
# Production Checklist:
#   [ ] Change DATABASE_PASSWORD to a strong password
#   [ ] Change JWT_SECRET to a unique 32+ character string
#   [ ] Set CORS_ORIGIN to your actual domain(s)
#   [ ] Set NODE_ENV=production
#   [ ] Review LOG_LEVEL settings (recommend: warn or error)
#   [ ] Enable rate limiting variables
#   [ ] Configure external services (Sentry, etc.) as needed
#
# =============================================================================
